<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pon Chat PRO</title>

<style>
body{
    margin:0;
    font-family:Arial,sans-serif;
    background:#0a0a0a;
    color:white;
    text-align:center;
}

input, button{
    padding:10px;
    margin:5px;
    border-radius:5px;
    outline:none;
}

input{
    border:2px solid cyan;
    background:#111;
    color:white;
}

button{
    border:none;
    background:#111;
    color:cyan;
    cursor:pointer;
    font-weight:bold;
    animation: glow 4s linear infinite;
}

@keyframes glow{
0%{box-shadow:0 0 10px red;}
25%{box-shadow:0 0 10px yellow;}
50%{box-shadow:0 0 10px cyan;}
75%{box-shadow:0 0 10px magenta;}
100%{box-shadow:0 0 10px red;}
}

.chat-box{
    width:60%;
    height:300px;
    margin:20px auto;
    background:#111;
    overflow-y:auto;
    padding:10px;
    border-radius:10px;
    border:2px solid cyan;
}

.users-box{
    width:20%;
    height:300px;
    background:#111;
    overflow-y:auto;
    border-radius:10px;
    border:2px solid magenta;
    padding:10px;
    float:right;
}
</style>
</head>
<body>

<h2>ðŸŒˆ Pon Chat PRO</h2>

<!-- Login / Register -->
<div id="auth">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<br>
<button onclick="register()">Crear Cuenta</button>
<button onclick="login()">Login</button>
</div>

<!-- Panel principal -->
<div id="panel" style="display:none;">
<h3 id="userEmail"></h3>

<input type="text" id="newServer" placeholder="Nombre del servidor">
<button onclick="createServer()">Crear Servidor</button>

<div id="serverList"></div>

<div id="chatSection" style="display:none;">
<h3 id="serverTitle"></h3>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="messageInput" placeholder="Mensaje">
<button onclick="sendMessage()">Enviar</button>
<div class="users-box" id="usersBox"><h4>Usuarios</h4></div>
</div>

<button onclick="logout()">Cerrar SesiÃ³n</button>
</div>

<audio id="msgSound">
<source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”¥ Pega tu configuraciÃ³n real de Firebase aquÃ­
var firebaseConfig = {
  apiKey: "PEGA_AQUI",
  authDomain: "PEGA_AQUI",
  databaseURL: "PEGA_AQUI",
  projectId: "PEGA_AQUI",
  storageBucket: "PEGA_AQUI",
  messagingSenderId: "PEGA_AQUI",
  appId: "PEGA_AQUI"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let currentServer = "";
let userRef = "";

// Registro
function register(){
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value.trim();
    if(!email || !pass) return alert("Completa los campos");
    auth.createUserWithEmailAndPassword(email,pass).catch(e=>alert(e.message));
}

// Login
function login(){
    const email = document.getElementById("email").value.trim();
    const pass = document.getElementById("password").value.trim();
    if(!email || !pass) return alert("Completa los campos");
    auth.signInWithEmailAndPassword(email,pass).catch(e=>alert(e.message));
}

// Logout
function logout(){
    auth.signOut();
}

// Estado de autenticaciÃ³n
auth.onAuthStateChanged(user=>{
    if(user){
        document.getElementById("auth").style.display="none";
        document.getElementById("panel").style.display="block";
        document.getElementById("userEmail").innerText="Conectado: "+user.email;
        loadServers();
    }else{
        document.getElementById("auth").style.display="block";
        document.getElementById("panel").style.display="none";
    }
});

// Crear servidor
function createServer(){
    const name = document.getElementById("newServer").value.trim();
    if(!name) return;
    db.ref("servers/"+name).set({createdBy: auth.currentUser.email});
}

// Cargar lista de servidores
function loadServers(){
    db.ref("servers").on("value", snap=>{
        const list = document.getElementById("serverList");
        list.innerHTML="<h4>Servidores:</h4>";
        snap.forEach(child=>{
            const btn=document.createElement("button");
            btn.innerText=child.key;
            btn.onclick=()=>joinServer(child.key);
            list.appendChild(btn);
        });
    });
}

// Unirse a servidor
function joinServer(name){
    currentServer=name;
    document.getElementById("chatSection").style.display="block";
    document.getElementById("serverTitle").innerText="Servidor: "+name;
    userRef = db.ref("servers/"+currentServer+"/users/"+auth.currentUser.uid);
    userRef.set(auth.currentUser.email);
    userRef.onDisconnect().remove();
    listenMessages();
    listenUsers();
}

// Enviar mensaje
function sendMessage(){
    const msg = document.getElementById("messageInput").value.trim();
    if(!msg) return;
    db.ref("servers/"+currentServer+"/messages").push({
        user: auth.currentUser.email,
        text: msg
    });
    document.getElementById("messageInput").value="";
}

// Escuchar mensajes
function listenMessages(){
    db.ref("servers/"+currentServer+"/messages").limitToLast(100)
    .on("child_added",snap=>{
        const data = snap.val();
        const box = document.getElementById("chatBox");
        box.innerHTML += `<div><b>${data.user}:</b> ${data.text}</div>`;
        box.scrollTop=box.scrollHeight;
        document.getElementById("msgSound").play();
    });
}

// Escuchar usuarios
function listenUsers(){
    db.ref("servers/"+currentServer+"/users").on("value",snap=>{
        const box=document.getElementById("usersBox");
        box.innerHTML="<h4>Usuarios</h4>";
        snap.forEach(child=>{
            box.innerHTML+=`<div>${child.val()}</div>`;
        });
    });
}
</script>

</body>
</html>
